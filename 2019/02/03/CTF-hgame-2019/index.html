<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="r1ngs&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      hgame2019几道有意思的Crypto | r1ngs&#39;s blog
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/foundation.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>r1ngs's blog</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<div id="article-banner">
  <h2>hgame2019几道有意思的Crypto</h2>
  <p class="post-date">2019-02-03</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h2 id="week-1"><a href="#week-1" class="headerlink" title="week 1"></a>week 1</h2><h3 id="perfect-secrecy"><a href="#perfect-secrecy" class="headerlink" title="perfect_secrecy"></a>perfect_secrecy</h3><p>描述：</p>
<blockquote>
<p>Mom told me OTP is perfect secrecy!（结果加上hgame{}）</p>
</blockquote>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strxor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join(hex(x ^ y)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> (x, y) <span class="keyword">in</span> zip(a, b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fp = open(<span class="string">'poem.txt'</span>, <span class="string">'rb'</span>)</span><br><span class="line">flag = <span class="string">"*********************************"</span></span><br><span class="line">strings = fp.readlines()</span><br><span class="line">key = hex(random.randint(<span class="number">2</span>**<span class="number">511</span>, <span class="number">2</span>**<span class="number">512</span>))[<span class="number">2</span>:]</span><br><span class="line">strs = [strxor(i[:<span class="number">-3</span>], binascii.unhexlify(key)) <span class="keyword">for</span> i <span class="keyword">in</span> strings]</span><br><span class="line">result = strxor(flag.encode(<span class="string">'utf-8'</span>), binascii.unhexlify(key))</span><br><span class="line">print(strs)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">output:</span></span><br><span class="line"><span class="string">['daaa4b4e8c996dc786889cd63bc4df4d1e7dc6f3f0b7a0b61ad48811f6f7c9bfabd7083c53ba54',</span></span><br><span class="line"><span class="string">'c5a342468c8c7a88999a9dd623c0cc4b0f7c829acaf8f3ac13c78300b3b1c7a3ef8e193840bb',</span></span><br><span class="line"><span class="string">'dda342458c897a8285df879e3285ce511e7c8d9afff9b7ff15de8a16b394c7bdab920e7946a05e9941d8308e',</span></span><br><span class="line"><span class="string">'d9b05b4cd5ce7c8f938bd39e24d0df191d7694dfeaf8bfbb56e28900e1b8dff1bb985c2d5aa154',</span></span><br><span class="line"><span class="string">'d9aa4b00c88b7fc79d99d38223c08d54146b88d3f0f0f38c03df8d52f0bfc1bda3d7133712a55e9948c32c8a',</span></span><br><span class="line"><span class="string">'c4b60e46c9827cc79e9698936bd1c55c5b6e87c8f0febdb856fe8052e4bfc9a5efbe5c3f57ad4b9944de34',</span></span><br><span class="line"><span class="string">'d9aa5700da817f94d29e81936bc4c1555b7b94d5f5f2bdff37df8252ffbecfb9bbd7152a12bc4fc00ad7229090',</span></span><br><span class="line"><span class="string">'c4e24645cd9c28939a86d3982ac8c819086989d1fbf9f39e18d5c601fbb6dab4ef9e12795bbc549959d9229090',</span></span><br><span class="line"><span class="string">'d9aa4b598c80698a97df879e2ec08d5b1e7f89c8fbb7beba56f0c619fdb2c4bdef8313795fa149dc0ad4228f',</span></span><br><span class="line"><span class="string">'cce25d48d98a6c8280df909926c0de19143983c8befab6ff21d99f52e4b2daa5ef83143647e854d60ad5269c87',</span></span><br><span class="line"><span class="string">'d9aa4b598c85668885df9d993f85e419107783cdbee3bbba1391b11afcf7c3bfaa805c2d5aad42995ede2cdd82977244',</span></span><br><span class="line"><span class="string">'e1ad40478c82678995df809e2ac9c119323994cffbb7a7b713d4c626fcb888b5aa920c354be853d60ac5269199',</span></span><br><span class="line"><span class="string">'c4ac0e53c98d7a8286df84936bc8c84d5b50889aedfebfba18d28352daf7cfa3a6920a3c',</span></span><br><span class="line"><span class="string">'d9aa4f548c9a609ed297969739d18d5a146c8adebef1bcad11d49252c7bfd1f1bc87152b5bbc07dd4fd226948397',</span></span><br><span class="line"><span class="string">'c4a40e698c9d6088879397d626c0c84d5b6d8edffbb792b902d49452ffbec6b6ef8e193840',</span></span><br><span class="line"><span class="string">'c5ad5900df8667929e9bd3bf6bc2df5c1e6dc6cef6f2b6ff21d8921ab3a4c1bdaa991f3c12a949dd0ac5269c']</span></span><br><span class="line"><span class="string">'c2967e7fc59d57899d8bac852ac3c866127fb9d7f1e5b68002d9871cccb8c6b2aa'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h4 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a>非预期解</h4><p>自己非预期了，直接通过暴破$key$的每一个字节判断每条$cipher$的对应位置的字节是不是都是大小写字母或者空格，把$key​$恢复了出来，当时的解题脚本已经删了，有个截图凑合看吧2333</p>
<p><img src="http://i1.bvimg.com/678166/bf639cb3acb73979.png" alt=""></p>
<p>比较巧合的是刚好除了第一个字节有多种可能以外，其他的字节都只有一种可能</p>
<h4 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h4><p>首先，如果我们运行下面的代码，程序输出结果是空，这说明任意两个字母异或的结果都不是字母</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> letters</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> letters:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letters:</span><br><span class="line">        tmp = strxor(i, j)</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">in</span> letters:</span><br><span class="line">            <span class="keyword">print</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>而对于空格来说，空格和任意字母（大写/小写）异或的结果都是这个字母的（小写/大写），而$C_1\;xor\;C_2 = m_1\;xor\;m_2$</p>
<p>所以，如果两个密文异或的结果里面有字母的话，就很有可能一个是字母一个是空格，那么我们再将其中一个密文和另外几个密文异或也是字母或者chr(0)的话就可以确定这个明文是空格，而我们再将它和目标密文异或就能得到目标明文了</p>
<p>自己写了个轮子，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> letters</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s</span><br><span class="line"></span><br><span class="line">cipher = [</span><br><span class="line"><span class="string">'daaa4b4e8c996dc786889cd63bc4df4d1e7dc6f3f0b7a0b61ad48811f6f7c9bfabd7083c53ba54'</span>,</span><br><span class="line"><span class="string">'c5a342468c8c7a88999a9dd623c0cc4b0f7c829acaf8f3ac13c78300b3b1c7a3ef8e193840bb'</span>,</span><br><span class="line"><span class="string">'dda342458c897a8285df879e3285ce511e7c8d9afff9b7ff15de8a16b394c7bdab920e7946a05e9941d8308e'</span>,</span><br><span class="line"><span class="string">'d9b05b4cd5ce7c8f938bd39e24d0df191d7694dfeaf8bfbb56e28900e1b8dff1bb985c2d5aa154'</span>,</span><br><span class="line"><span class="string">'d9aa4b00c88b7fc79d99d38223c08d54146b88d3f0f0f38c03df8d52f0bfc1bda3d7133712a55e9948c32c8a'</span>,</span><br><span class="line"><span class="string">'c4b60e46c9827cc79e9698936bd1c55c5b6e87c8f0febdb856fe8052e4bfc9a5efbe5c3f57ad4b9944de34'</span>,</span><br><span class="line"><span class="string">'d9aa5700da817f94d29e81936bc4c1555b7b94d5f5f2bdff37df8252ffbecfb9bbd7152a12bc4fc00ad7229090'</span>,</span><br><span class="line"><span class="string">'c4e24645cd9c28939a86d3982ac8c819086989d1fbf9f39e18d5c601fbb6dab4ef9e12795bbc549959d9229090'</span>,</span><br><span class="line"><span class="string">'d9aa4b598c80698a97df879e2ec08d5b1e7f89c8fbb7beba56f0c619fdb2c4bdef8313795fa149dc0ad4228f'</span>,</span><br><span class="line"><span class="string">'cce25d48d98a6c8280df909926c0de19143983c8befab6ff21d99f52e4b2daa5ef83143647e854d60ad5269c87'</span>,</span><br><span class="line"><span class="string">'d9aa4b598c85668885df9d993f85e419107783cdbee3bbba1391b11afcf7c3bfaa805c2d5aad42995ede2cdd82977244'</span>,</span><br><span class="line"><span class="string">'e1ad40478c82678995df809e2ac9c119323994cffbb7a7b713d4c626fcb888b5aa920c354be853d60ac5269199'</span>,</span><br><span class="line"><span class="string">'c4ac0e53c98d7a8286df84936bc8c84d5b50889aedfebfba18d28352daf7cfa3a6920a3c'</span>,</span><br><span class="line"><span class="string">'d9aa4f548c9a609ed297969739d18d5a146c8adebef1bcad11d49252c7bfd1f1bc87152b5bbc07dd4fd226948397'</span>,</span><br><span class="line"><span class="string">'c4a40e698c9d6088879397d626c0c84d5b6d8edffbb792b902d49452ffbec6b6ef8e193840'</span>,</span><br><span class="line"><span class="string">'c5ad5900df8667929e9bd3bf6bc2df5c1e6dc6cef6f2b6ff21d8921ab3a4c1bdaa991f3c12a949dd0ac5269c'</span>]</span><br><span class="line"></span><br><span class="line">target = <span class="string">'c2967e7fc59d57899d8bac852ac3c866127fb9d7f1e5b68002d9871cccb8c6b2aa'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">    cipher[i] = cipher[i][<span class="number">0</span>:len(target)]</span><br><span class="line">    cipher[i] = n2s(int(cipher[i], <span class="number">16</span>))</span><br><span class="line">target = n2s(int(target, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(j, i)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">        <span class="keyword">if</span> strxor(cipher[j][i], cipher[pos][i]) <span class="keyword">not</span> <span class="keyword">in</span> letters + chr(<span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(cipher)):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(len(cipher) - j - <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> strxor(cipher[j][i], cipher[k+j+<span class="number">1</span>][i]) <span class="keyword">in</span> letters:</span><br><span class="line">                <span class="keyword">if</span> check(j, i):</span><br><span class="line">                    <span class="keyword">return</span> strxor(strxor(cipher[j][i], target[i]), <span class="string">' '</span>)</span><br><span class="line">                <span class="keyword">elif</span> check(k+j+<span class="number">1</span>, i):</span><br><span class="line">                    <span class="keyword">return</span> strxor(strxor(cipher[k+j+<span class="number">1</span>][i], target[i]), <span class="string">' '</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'?'</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(target)):</span><br><span class="line">    flag += find(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>
<p>最终输出结果为：</p>
<p><code>?TP_is_not_safe_if_more_than_once</code></p>
<p>其中?代表这个位置是不确定的，那么很显然应该是题目描述里的OTP的O了</p>
<h2 id="week-2"><a href="#week-2" class="headerlink" title="week 2"></a>week 2</h2><h3 id="HILL"><a href="#HILL" class="headerlink" title="HILL"></a>HILL</h3><p>描述：</p>
<blockquote>
<p>hill密码，秘钥是3x3矩阵，flag的密文是TCSHXZTCXAPBDKJVJDOHJEAE，flag中含有BABYSHILL，flag是有意义的英文，最终提交格式: hgame{有意义的英文}</p>
</blockquote>
<h4 id="预期解-1"><a href="#预期解-1" class="headerlink" title="预期解"></a>预期解</h4><p>$KP=C$</p>
<p>$P=K^{-1}C$</p>
<p>$PC^{-1}=K^{-1}$</p>
<p>BABYSHILL和C中连续的3X3矩阵的逆相乘就是K的逆</p>
<p>这里要注意的是Hill密码的逆矩阵和线性代数里的不一样，这个坑踩了一天= =</p>
<p><img src="http://i1.bvimg.com/678166/29a1d2c5fd4c2d49.jpg" alt=""></p>
<p>完整解题脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cipher = [</span><br><span class="line">    [<span class="string">'T'</span>, <span class="string">'H'</span>, <span class="string">'T'</span>, <span class="string">'A'</span>, <span class="string">'D'</span>, <span class="string">'V'</span>, <span class="string">'O'</span>, <span class="string">'E'</span>],</span><br><span class="line">    [<span class="string">'C'</span>, <span class="string">'X'</span>, <span class="string">'C'</span>, <span class="string">'P'</span>, <span class="string">'K'</span>, <span class="string">'J'</span>, <span class="string">'H'</span>, <span class="string">'A'</span>],</span><br><span class="line">    [<span class="string">'S'</span>, <span class="string">'Z'</span>, <span class="string">'X'</span>, <span class="string">'B'</span>, <span class="string">'J'</span>, <span class="string">'D'</span>, <span class="string">'J'</span>, <span class="string">'E'</span>]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        cipher[i][j] = ord(cipher[i][j])<span class="number">-65</span></span><br><span class="line"></span><br><span class="line">plain = [</span><br><span class="line">    [<span class="string">'B'</span>, <span class="string">'Y'</span>, <span class="string">'I'</span>],</span><br><span class="line">    [<span class="string">'A'</span>, <span class="string">'S'</span>, <span class="string">'L'</span>],</span><br><span class="line">    [<span class="string">'B'</span>, <span class="string">'H'</span>, <span class="string">'L'</span>]</span><br><span class="line">]</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">plain = [</span></span><br><span class="line"><span class="string">    ['0', 'B', 'H'],</span></span><br><span class="line"><span class="string">    ['B', 'Y', 'I'],</span></span><br><span class="line"><span class="string">    ['A', 'S', 'L']</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">plain = [</span></span><br><span class="line"><span class="string">    ['A', 'S', 'L'],  </span></span><br><span class="line"><span class="string">    ['B', 'H', 'L'],</span></span><br><span class="line"><span class="string">    ['Y', 'I', '0']</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        plain[i][j] = ord(plain[i][j])<span class="number">-65</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_int</span><span class="params">(m)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            m[i][j] = int(round(m[i][j]))</span><br><span class="line">    <span class="keyword">return</span> matrix(m)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_inv_matrix</span><span class="params">(m)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'''print int(round(linalg.det(m)))</span></span><br><span class="line"><span class="string">    print invert(int(round(linalg.det(m))), 26)'''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        kk = invert(int(round(linalg.det(m))), <span class="number">26</span>)</span><br><span class="line">        inv_m = linalg.inv(m)</span><br><span class="line">        tmp = inv_m * linalg.det(m)</span><br><span class="line"></span><br><span class="line">        test_real_inv = array(kk * tmp)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                test_real_inv[i][j] = int(round(test_real_inv[i][j])) % <span class="number">26</span></span><br><span class="line">        <span class="keyword">return</span> matrix(test_real_inv)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">print</span> int(round(linalg.det(m)))</span><br><span class="line">        <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span><span class="params">(m)</span>:</span></span><br><span class="line">    str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            str+=chr(int(round(m[j][i])%<span class="number">26</span>)+<span class="number">97</span>)</span><br><span class="line">    <span class="keyword">print</span> str</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">for i in range(26):</span></span><br><span class="line"><span class="string">    plain[0][0] = i</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">new_cipher = matrix(cipher)</span><br><span class="line">new_plain = matrix(plain)</span><br><span class="line"></span><br><span class="line">cipher_matrix = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    tmp = []</span><br><span class="line">    tmp.append(cipher[<span class="number">0</span>][i:i+<span class="number">3</span>])</span><br><span class="line">    tmp.append(cipher[<span class="number">1</span>][i:i+<span class="number">3</span>])</span><br><span class="line">    tmp.append(cipher[<span class="number">2</span>][i:i+<span class="number">3</span>])</span><br><span class="line">    cipher_matrix.append(tmp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C_1 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    C_1.append(get_inv_matrix(to_int(array(cipher_matrix[i]))))</span><br><span class="line"></span><br><span class="line">K_1 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    K_1.append(dot(new_plain, C_1[i]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    <span class="string">'''print array(dot(K_1[j], new_cipher))'''</span></span><br><span class="line">    flag(array(dot(K_1[j],matrix(cipher))))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'-'</span>*<span class="number">65</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">test = [</span></span><br><span class="line"><span class="string">    [6, 24, 1],</span></span><br><span class="line"><span class="string">    [13, 16, 10],</span></span><br><span class="line"><span class="string">    [20, 17, 15]</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">print get_inv_matrix(test)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h4 id="流氓解"><a href="#流氓解" class="headerlink" title="流氓解"></a>流氓解</h4><p>当然，这个题还可以爆破，但是如果直接对$K$进行爆破的话，一共有$26^9=5429503678976$种可能，这是不太现实的</p>
<p>然而我们可以对$K^{-1}$的每一行进行爆破，这样就很快了，而且，由于直接爆破$K^{-1}​$，跳过了求逆矩阵，使得这种方法简单得多，具体代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cipher = [</span><br><span class="line">    [<span class="string">'T'</span>, <span class="string">'H'</span>, <span class="string">'T'</span>, <span class="string">'A'</span>, <span class="string">'D'</span>, <span class="string">'V'</span>, <span class="string">'O'</span>, <span class="string">'E'</span>],</span><br><span class="line">    [<span class="string">'C'</span>, <span class="string">'X'</span>, <span class="string">'C'</span>, <span class="string">'P'</span>, <span class="string">'K'</span>, <span class="string">'J'</span>, <span class="string">'H'</span>, <span class="string">'A'</span>],</span><br><span class="line">    [<span class="string">'S'</span>, <span class="string">'Z'</span>, <span class="string">'X'</span>, <span class="string">'B'</span>, <span class="string">'J'</span>, <span class="string">'D'</span>, <span class="string">'J'</span>, <span class="string">'E'</span>]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        cipher[i][j] = ord(cipher[i][j])<span class="number">-65</span></span><br><span class="line"></span><br><span class="line">plain = [</span><br><span class="line">    [<span class="string">'B'</span>, <span class="string">'Y'</span>, <span class="string">'I'</span>],</span><br><span class="line">    [<span class="string">'A'</span>, <span class="string">'S'</span>, <span class="string">'L'</span>],</span><br><span class="line">    [<span class="string">'B'</span>, <span class="string">'H'</span>, <span class="string">'L'</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        plain[i][j] = ord(plain[i][j])<span class="number">-65</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">K = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">            tmp = []</span><br><span class="line">            tmp.append(i)</span><br><span class="line">            tmp.append(j)</span><br><span class="line">            tmp.append(k)</span><br><span class="line">            K.append(tmp)</span><br><span class="line"></span><br><span class="line">cipher_matrix = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        tmp.append(cipher[j][i])</span><br><span class="line">    cipher_matrix.append(tmp)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> len(a) == len(b) == <span class="number">3</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> zip(a, b):</span><br><span class="line">        num += i*j</span><br><span class="line">    <span class="keyword">return</span> chr((num%<span class="number">26</span>)+<span class="number">65</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">for key in K:</span></span><br><span class="line"><span class="string">    str = ''</span></span><br><span class="line"><span class="string">    for i in range(len(cipher_matrix)):</span></span><br><span class="line"><span class="string">        str += multi(key, cipher_matrix[i])</span></span><br><span class="line"><span class="string">    if 'BHL' in str:</span></span><br><span class="line"><span class="string">        print key, str</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">K1 = [[<span class="number">5</span>, <span class="number">1</span>, <span class="number">23</span>], [<span class="number">5</span>, <span class="number">14</span>, <span class="number">10</span>], [<span class="number">9</span>, <span class="number">8</span>, <span class="number">11</span>], [<span class="number">15</span>, <span class="number">4</span>, <span class="number">17</span>], [<span class="number">24</span>, <span class="number">25</span>, <span class="number">25</span>], [<span class="number">25</span>, <span class="number">23</span>, <span class="number">1</span>]]</span><br><span class="line">K2 = [[<span class="number">6</span>, <span class="number">9</span>, <span class="number">23</span>], [<span class="number">21</span>, <span class="number">4</span>, <span class="number">3</span>], [<span class="number">21</span>, <span class="number">17</span>, <span class="number">5</span>], [<span class="number">23</span>, <span class="number">20</span>, <span class="number">23</span>]]</span><br><span class="line">K3 = [[<span class="number">1</span>, <span class="number">15</span>, <span class="number">16</span>], [<span class="number">4</span>, <span class="number">18</span>, <span class="number">17</span>], [<span class="number">5</span>, <span class="number">0</span>, <span class="number">2</span>], [<span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">16</span>, <span class="number">12</span>, <span class="number">19</span>], [<span class="number">24</span>, <span class="number">0</span>, <span class="number">11</span>]]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span><span class="params">(m)</span>:</span></span><br><span class="line">    str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            str+=chr(int(round(m[j][i])%<span class="number">26</span>)+<span class="number">97</span>)</span><br><span class="line">    <span class="keyword">print</span> str</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k1 <span class="keyword">in</span> K1:</span><br><span class="line">    <span class="keyword">for</span> k2 <span class="keyword">in</span> K2:</span><br><span class="line">        <span class="keyword">for</span> k3 <span class="keyword">in</span> K3:</span><br><span class="line">            K = []</span><br><span class="line">            K.append(k1)</span><br><span class="line">            K.append(k2)</span><br><span class="line">            K.append(k3)</span><br><span class="line">            flag(array(dot(matrix(K),matrix(cipher))))</span><br></pre></td></tr></table></figure>
<p>在输出的结果里查找$BABYSHILL$就可以找到正确的flag了</p>
<h2 id="week-3"><a href="#week-3" class="headerlink" title="week 3"></a>week 3</h2><h3 id="P4ndd-n"><a href="#P4ndd-n" class="headerlink" title="P4ndd!n@!"></a>P4ndd!n@!</h3><p>描述：</p>
<blockquote>
<p>Aris跑了过来 嘴里大喊”CBC!” 并递给了我一张纸条<br>lpFsOPZm9UztVP30SHertuXoWkOEP4Ij7UcjGM1xvFIw78Ti15UwL9YY0xn4syBxW/2BgzRtsZHGksUmWgfr5Q==(参数要用base64编码一发)</p>
<p>URL: <a href="http://47.95.212.185:23450/padding?text" target="_blank" rel="noopener">http://47.95.212.185:23450/padding?text</a></p>
</blockquote>
<p>其实这道题就是一个非常单纯的padding oracle，主要的坑就是没有给源代码，有点搞不懂逻辑，通过<del>py出题人</del>仔细分析，可以得到：</p>
<p>题目给的base64编码的字符串是IV+cipher，我们首先要做的就是解密cipher，给的接口的回显的Error的意思是padding正确，也就是填充的个数和填充的值都正确，但是解密的值不正确，回显的Something error!的意思就是padding不正确</p>
<p>我们可以通过对plain对应的前一段的cipher的值做更改，利用cbc翻转字节攻击逐位枚举plain，依据Error​的回显来判断枚举是否成功，也就可以恢复所有的明文了</p>
<p>最后一个地方稍微脑洞一点，解密的值是<code>If you R Aris, I will give you flag.</code> 意思是得构造cipher使得解密的明文是Aris，然后才给你flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> chr(ord(a)^ord(b))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_source_code</span><span class="params">(url)</span>:</span></span><br><span class="line">    web = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> web.text</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://47.95.212.185:23450/padding?text='</span></span><br><span class="line"></span><br><span class="line">str = <span class="string">'lpFsOPZm9UztVP30SHertuXoWkOEP4Ij7UcjGM1xvFIw78Ti15UwL9YY0xn4syBxW/2BgzRtsZHGksUmWgfr5Q=='</span></span><br><span class="line">cipher = b64decode(str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cipher_list = list(cipher)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">for i in range(1, 17):</span></span><br><span class="line"><span class="string">    cipher_list[63-16] = xor(xor(cipher[63-16], chr(i)), chr(1))</span></span><br><span class="line"><span class="string">    state = get_source_code(url+b64encode(''.join(cipher_list)))</span></span><br><span class="line"><span class="string">    if state == 'Error':</span></span><br><span class="line"><span class="string">        print i</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">flag1=<span class="string">'lag.'</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">cipher_list[63-16-12] = xor(xor(cipher[63-16-12], '.'), chr(17))</span></span><br><span class="line"><span class="string">cipher_list[63-16-13] = xor(xor(cipher[63-16-13], 'g'), chr(17))</span></span><br><span class="line"><span class="string">cipher_list[63-16-14] = xor(xor(cipher[63-16-14], 'a'), chr(17))</span></span><br><span class="line"><span class="string">cipher_list[63-16-15] = xor(xor(cipher[63-16-15], 'l'), chr(17))</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">cipher_list = cipher_list[:<span class="number">48</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag2 = <span class="string">' will give you f'</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">for i in range(16):</span></span><br><span class="line"><span class="string">    for k in range(i):</span></span><br><span class="line"><span class="string">        cipher_list[47 - k - 16] = xor(xor(cipher[47 - k - 16], flag2[-k-1]), chr(i + 1))</span></span><br><span class="line"><span class="string">    for j in range(256):</span></span><br><span class="line"><span class="string">        cipher_list[47 - i - 16] = xor(xor(cipher[47 - i - 16], chr(j)), chr(i+1))</span></span><br><span class="line"><span class="string">        state = get_source_code(url + b64encode(''.join(cipher_list)))</span></span><br><span class="line"><span class="string">        if state == 'Error':</span></span><br><span class="line"><span class="string">            flag2=chr(j)+flag2</span></span><br><span class="line"><span class="string">            print flag2</span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">flag3 = <span class="string">'If you R Aris, I'</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">cipher_list = cipher_list[:32]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(16):</span></span><br><span class="line"><span class="string">    for k in range(i):</span></span><br><span class="line"><span class="string">        cipher_list[31 - k - 16] = xor(xor(cipher[31 - k - 16], flag3[-k-1]), chr(i + 1))</span></span><br><span class="line"><span class="string">    for j in range(32, 256):</span></span><br><span class="line"><span class="string">        cipher_list[31 - i - 16] = xor(xor(cipher[31 - i - 16], chr(j)), chr(i+1))</span></span><br><span class="line"><span class="string">        sleep(0.5)</span></span><br><span class="line"><span class="string">        state = get_source_code(url + b64encode(''.join(cipher_list)))</span></span><br><span class="line"><span class="string">        if state == 'Error':</span></span><br><span class="line"><span class="string">            flag3=chr(j)+flag3</span></span><br><span class="line"><span class="string">            print flag3</span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">fake_flag = flag3+flag2+flag1</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> fake_flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">IV = cipher[:<span class="number">16</span>]</span><br><span class="line">tmp1 = strxor(strxor(IV[<span class="number">0</span>:<span class="number">4</span>], <span class="string">'If y'</span>), <span class="string">'Aris'</span>)</span><br><span class="line">tmp2 = strxor(strxor(IV[<span class="number">4</span>:<span class="number">16</span>], <span class="string">'ou R Aris, I'</span>), chr(<span class="number">12</span>)*<span class="number">12</span>)</span><br><span class="line"><span class="keyword">print</span> get_source_code(url+b64encode(tmp1+tmp2+cipher[<span class="number">16</span>:<span class="number">32</span>]))</span><br></pre></td></tr></table></figure>
<h3 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h3><p>描述：</p>
<blockquote>
<p>e = 12<br>p = 58380004430307803367806996460773123603790305789098384488952056206615768274527<br>q = 81859526975720060649380098193671612801200505029127076539457680155487669622867<br>ciphertext = 206087215323690202467878926681944491769659156726458690815919286163630886447291570510196171585626143608988384615185921752409380788006476576337410136447460</p>
</blockquote>
<p>这道题已经告诉了$p、q$但是由于$e$是$12$不是素数，和$\varphi(n)$不互素，所以不能用普通的RSA求逆元的算法解这道题，这个时候就需要我们<del>打出题人</del>冷静分析了</p>
<p>由于$m^{12}\equiv c\;(mod\;n)​$则$(m^4)^3\equiv c\;(mod\;n)​$，而$3​$是一个奇素数，所以$3​$的逆元$d​$存在，那么我们有$m^4\equiv c^d\;(mod\;n)​$，当时我觉得4是一个小公钥指数，那么直接用小公钥指数暴破攻击就可以了，于是我就用多进程直接开冲，暴破了1亿多次都没有出结果，而已经有人做出来的时候我就觉得自己的思路应该错了</p>
<p>此时已经临近深夜，正打算挂机暴破一整晚的我突然就想到怎么做了（这周的crypto题给我最深的感触的就是如果思路正确很快就能出答案，如果不正确或者有偏差就会既费时又费力），$m^4\equiv (m^2)^2\equiv c^d\;(mod\;n)​$，而$(m^2)^2​$可以看做是两个Rabin加密，且$p、q​$都是模$4​$余$3​$的素数，直接可以秒解了（话说是不是真的有人暴破小公钥指数做出来的？）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">58380004430307803367806996460773123603790305789098384488952056206615768274527</span></span><br><span class="line">q = <span class="number">81859526975720060649380098193671612801200505029127076539457680155487669622867</span></span><br><span class="line">n = p*q</span><br><span class="line">fn = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">d1 = gmpy2.invert(<span class="number">3</span>, fn)</span><br><span class="line">c = <span class="number">206087215323690202467878926681944491769659156726458690815919286163630886447291570510196171585626143608988384615185921752409380788006476576337410136447460</span></span><br><span class="line"></span><br><span class="line">c1 = pow(c, d1, n)</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">0x2a9428e86d9010e3f77d5d50c03c62f041db75a63fc74ed65de56d09</span></span><br><span class="line"></span><br><span class="line">inv_p = gmpy2.invert(p, q)</span><br><span class="line">inv_q = gmpy2.invert(q, p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mp = pow(c1, (p + <span class="number">1</span>) / <span class="number">4</span>, p)</span><br><span class="line">mq = pow(c1, (q + <span class="number">1</span>) / <span class="number">4</span>, q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = (inv_p * p * mq + inv_q * q * mp) % n</span><br><span class="line">b = n - int(a)</span><br><span class="line">c = (inv_p * p * mq - inv_q * q * mp) % n</span><br><span class="line">d = n - int(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> (a, b, c, d):</span><br><span class="line">    s = <span class="string">'%x'</span> % i</span><br><span class="line">    <span class="keyword">if</span> len(s) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        s = <span class="string">'0'</span> + s</span><br><span class="line">    <span class="keyword">print</span> n2s(int(s, <span class="number">16</span>))</span><br></pre></td></tr></table></figure>
<h3 id="basicmath"><a href="#basicmath" class="headerlink" title="basicmath"></a>basicmath</h3><p>描述：</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">&gt; </span><br><span class="line">&gt; flag = <span class="string">'*******************'</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; m = int(flag.encode(<span class="string">'hex'</span>), <span class="number">16</span>)</span><br><span class="line">&gt; p = getPrime(<span class="number">256</span>)</span><br><span class="line">&gt; <span class="keyword">while</span>(p % <span class="number">4</span> != <span class="number">3</span>):</span><br><span class="line">&gt;     p = getPrime(<span class="number">256</span>)</span><br><span class="line">&gt; a = pow(m, <span class="number">2</span>, p)</span><br><span class="line">&gt; print(p)</span><br><span class="line">&gt; print(a)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="string">'''</span></span><br><span class="line"><span class="string">&gt; p = 96844604612122594734846587450751002272823339993969599631517516290673675281347</span></span><br><span class="line"><span class="string">&gt; a = 5491280935375344696344639339035431520073311126446116169370534450549651945232</span></span><br><span class="line"><span class="string">&gt; '''</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>题目的要求就是解一个二次同余方程$m^2\equiv a\;(mod\;p)$，模数$p$是一个模$4$余$3$的奇素数</p>
<p>由欧拉判别定理，$a$是模$p$的平方剩余的充要条件是$a^{(p-1)/2} \equiv 1(mod\;p)$那么$a^{(p-1)/2}a \equiv a(mod\;p)$即$a^{(p+1)/2} \equiv a(mod\;p)$</p>
<p>又有$(a^{(p+1)/4})^2\equiv a\;(mod\;p)$，则令$k=\frac{p+1}{4}$，由于$p$模$4$余$3$，故$k$是一个整数，$(a^k)^2\equiv a \;(mod\;p)$，即$m^2\equiv (a^k)^2\;(mod\;p) $</p>
<p>所以$m\equiv ± a^k\;(mod\;p)​$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">96844604612122594734846587450751002272823339993969599631517516290673675281347</span></span><br><span class="line">a = <span class="number">5491280935375344696344639339035431520073311126446116169370534450549651945232</span></span><br><span class="line">k = (p+<span class="number">1</span>)/<span class="number">4</span></span><br><span class="line"><span class="keyword">print</span> n2s(pow(a, k, p))</span><br><span class="line"><span class="keyword">print</span> n2s(p-pow(a, k, p))</span><br></pre></td></tr></table></figure>
<h2 id="week-4"><a href="#week-4" class="headerlink" title="week 4"></a>week 4</h2><h3 id="easy-rsa"><a href="#easy-rsa" class="headerlink" title="easy_rsa"></a>easy_rsa</h3><p>描述：</p>
<blockquote>
<p>m为17位十进制数，提交格式hgame{m}</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; e1:<span class="number">0x33240</span></span><br><span class="line">&gt; e2:<span class="number">0x3e4f</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; n:<span class="number">0x9439682bf1b4ab48c43c524778c579cc844b60872275725c1dc893b5bcb358b9f136e4dab2a06318bb0c80e202a14bc54ea334519bec023934e01e9378abf329893f3870979e9f2f2be8fff4df931216a77007a2509f49f697bf286285e97fac5dc6e4a164b5c2cc430887b18136437ba67777bda05aafdeaf918221c812b4c7d1665238f84ab0fab7a77fcae92a0596e58343be7a8e6e75a5017c63a67eb11964970659cd6110e9ec6502288e9e443d86229ef2364dfecb63e2d90993a75356854eb874797340eece1b19974e86bee07019610467d44ec595e04af02b574a97fa98bdb2e779871c804219cab715f4a80fef7f8fb52251d86077560b39c1c2a1</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; c1:<span class="number">0x7c7f315a3ebbe305c1ad8bd2f73b1bb8e300912b6b8ba1b331ac2419d3da5a9a605fd62915c11f8921c450525d2efda7d48f1e503041498f4f0676760b43c770ff2968bd942c7ef95e401dd7facbd4e5404a0ed3ad96ae505f87c4e12439a2da636f047d84b1256c0e363f63373732cbaf24bda22d931d001dcca124f5a19f9e28608ebd90161e728b782eb67deeba4cc81b6df4e7ee29a156f51a0e5148618c6e81c31a91036c982debd1897e6f3c1e5e248789c933a4bf30d0721a18ab8708d827858b77c1a020764550a7fe2ebd48b6848d9c4d211fd853b7a02a859fa0c72160675d832c94e0e43355363a2166b3d41b8137100c18841e34ff52786867d</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; c2:<span class="number">0xf3a8b9b739196ba270c8896bd3806e9907fca2592d28385ef24afadc2a408b7942214dad5b9e14808ab988fb15fbd93e725edcc0509ab0dd1656557019ae93c38031d2a7c84895ee3da1150eda04cd2815ee3debaa7c2651b62639f785f6cabf83f93bf3cce7778ab369631ea6145438c3cd4d93d6f2759be3cc187651a33b3cc4c3b477604477143c32dfff62461fdfd9f8aa879257489bbf977417ce0fbe89e3f2464475624aafef57dd9ea60339793c69b53ca71d745d626f45e6a7beb9fcbd9d1a259433d36139345b7bb4f392e78f1b5be0d2c56ad50767ee851fac670946356b3c05d0605bf243b89c7e683cc75030b71633632fb95c84075201352d6</span></span><br><span class="line">&gt;     </span><br><span class="line">&gt; c1=pow(m, e1, n)</span><br><span class="line">&gt; c2=pow(m, e2, n)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>很明显的一个共模攻击</p>
<p>但是如果直接跑的话会报错，因为$e_1$和$e_2$是不互素的，下意识的算了一下$e_1$和$e_2$的$gcd$，为$3$</p>
<p>那么我们可以用共模计算$m^3​$为多少，然后用小公钥指数暴破就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line">N = <span class="number">0x9439682bf1b4ab48c43c524778c579cc844b60872275725c1dc893b5bcb358b9f136e4dab2a06318bb0c80e202a14bc54ea334519bec023934e01e9378abf329893f3870979e9f2f2be8fff4df931216a77007a2509f49f697bf286285e97fac5dc6e4a164b5c2cc430887b18136437ba67777bda05aafdeaf918221c812b4c7d1665238f84ab0fab7a77fcae92a0596e58343be7a8e6e75a5017c63a67eb11964970659cd6110e9ec6502288e9e443d86229ef2364dfecb63e2d90993a75356854eb874797340eece1b19974e86bee07019610467d44ec595e04af02b574a97fa98bdb2e779871c804219cab715f4a80fef7f8fb52251d86077560b39c1c2a1</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">cipher = <span class="number">211655262573966881062823795220179644607412162371069</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span><span class="params">(j)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> j</span><br><span class="line">    a, b = gmpy2.iroot(cipher + j * N, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> b == <span class="keyword">True</span>:</span><br><span class="line">        m = a</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'success! m-&gt;'</span>+str(m)</span><br><span class="line">        pool.terminate()</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SmallE</span><span class="params">()</span>:</span></span><br><span class="line">    inputs = range(<span class="number">0</span>, <span class="number">130000000</span>)</span><br><span class="line">    pool.map(calc, inputs)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pool = Pool(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'start'</span></span><br><span class="line">    SmallE()</span><br></pre></td></tr></table></figure>
<h3 id="MixedRSA-Easy"><a href="#MixedRSA-Easy" class="headerlink" title="MixedRSA_Easy"></a>MixedRSA_Easy</h3><p>描述：</p>
<blockquote>
<p>47.95.212.185 38610<br>由CNSS友情赞助 比心</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line">&gt; <span class="keyword">from</span> signal <span class="keyword">import</span> alarm</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">&gt;     <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">&gt;         a, b = b, a % b</span><br><span class="line">&gt;     <span class="keyword">return</span> a</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">ex_gcd</span><span class="params">(m, n)</span>:</span></span><br><span class="line">&gt;     x, y, x1, y1 = <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">&gt;     <span class="keyword">while</span> m % n:</span><br><span class="line">&gt;         x, x1 = x1 - m // n * x, x</span><br><span class="line">&gt;         y, y1 = y1 - m // n * y, y</span><br><span class="line">&gt;         m, n = n, m % n</span><br><span class="line">&gt;     <span class="keyword">return</span> n, x, y</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">inv</span><span class="params">(x, p)</span>:</span></span><br><span class="line">&gt;     g, y, k = ex_gcd(x, p)</span><br><span class="line">&gt;     <span class="keyword">if</span> y &lt; p:</span><br><span class="line">&gt;         y += p</span><br><span class="line">&gt;     <span class="keyword">return</span> y</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">&gt;     <span class="keyword">return</span> bytes(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(a, b))</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">MixedRSA</span>:</span></span><br><span class="line">&gt;     n = e = d = iv = BLOCK = <span class="number">0</span></span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, iv, block=<span class="number">256</span>)</span>:</span></span><br><span class="line">&gt;         self.BLOCK = block</span><br><span class="line">&gt;         p = getPrime(block * <span class="number">4</span>)</span><br><span class="line">&gt;         q = getPrime(block * <span class="number">4</span>)</span><br><span class="line">&gt;         self.n = p * q</span><br><span class="line">&gt;         phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">&gt;         self.e = getPrime(<span class="number">64</span>)</span><br><span class="line">&gt;         self.d = inv(self.e, phi)</span><br><span class="line">&gt;         iv *= block // len(iv)</span><br><span class="line">&gt;         self.iv = iv.rjust(block, <span class="string">b'\x00'</span>)</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">(self, s)</span>:</span></span><br><span class="line">&gt;         <span class="keyword">return</span> <span class="string">b'\x00'</span> * (-len(s) % self.BLOCK) + s</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">def</span> <span class="title">rsa_encrypt</span><span class="params">(self, m)</span>:</span></span><br><span class="line">&gt;         c = pow(int(m.hex(), <span class="number">16</span>), self.e, self.n)</span><br><span class="line">&gt;         c = hex(c)[<span class="number">2</span>:].rjust(self.BLOCK * <span class="number">2</span>, <span class="string">'0'</span>)</span><br><span class="line">&gt;         <span class="keyword">return</span> bytes.fromhex(c)</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">def</span> <span class="title">rsa_decrypt</span><span class="params">(self, c)</span>:</span></span><br><span class="line">&gt;         m = pow(int(c.hex(), <span class="number">16</span>), self.d, self.n)</span><br><span class="line">&gt;         m = hex(m)[<span class="number">2</span>:].rjust(self.BLOCK * <span class="number">2</span>, <span class="string">'0'</span>)</span><br><span class="line">&gt;         <span class="keyword">return</span> bytes.fromhex(m)</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(self, plaintext)</span>:</span></span><br><span class="line">&gt;         plaintext = self.padding(plaintext)</span><br><span class="line">&gt;         imd = self.iv</span><br><span class="line">&gt;         <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(plaintext), self.BLOCK):</span><br><span class="line">&gt;             m = xor(imd[-self.BLOCK:], plaintext[i: i + self.BLOCK])</span><br><span class="line">&gt;             imd += self.rsa_encrypt(m)</span><br><span class="line">&gt;         imd = imd[self.BLOCK:]</span><br><span class="line">&gt;         cipher = self.iv</span><br><span class="line">&gt;         <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(imd), self.BLOCK):</span><br><span class="line">&gt;             c = self.rsa_encrypt(cipher[-self.BLOCK:])</span><br><span class="line">&gt;             cipher += xor(c, imd[i: i + self.BLOCK])</span><br><span class="line">&gt;         <span class="keyword">return</span> cipher[self.BLOCK:]</span><br><span class="line">&gt; </span><br><span class="line">&gt;     <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(self, cipher)</span>:</span></span><br><span class="line">&gt;         cipher = self.iv + cipher</span><br><span class="line">&gt;         imd = <span class="string">b''</span></span><br><span class="line">&gt;         <span class="keyword">for</span> i <span class="keyword">in</span> range(self.BLOCK, len(cipher), self.BLOCK):</span><br><span class="line">&gt;             c = self.rsa_encrypt(cipher[i - self.BLOCK: i])</span><br><span class="line">&gt;             imd += xor(c, cipher[i: i + self.BLOCK])</span><br><span class="line">&gt;         imd = self.iv + imd</span><br><span class="line">&gt;         plaintext = <span class="string">b''</span></span><br><span class="line">&gt;         <span class="keyword">for</span> i <span class="keyword">in</span> range(self.BLOCK, len(imd), self.BLOCK):</span><br><span class="line">&gt;             m = self.rsa_decrypt(imd[i: i + self.BLOCK])</span><br><span class="line">&gt;             plaintext += xor(m, imd[i - self.BLOCK: i])</span><br><span class="line">&gt;         <span class="keyword">return</span> plaintext</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">&gt;     alarm(<span class="number">60</span>)</span><br><span class="line">&gt;     mix = MixedRSA(FLAG)</span><br><span class="line">&gt;     <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">&gt;         print(<span class="string">"Choose:\n[1] Encrypt (hex)\n[2] Decrypt (hex)"</span>)</span><br><span class="line">&gt;         op = input()</span><br><span class="line">&gt;         <span class="keyword">if</span> op == <span class="string">'1'</span>:</span><br><span class="line">&gt;             msg = bytes.fromhex(input())</span><br><span class="line">&gt;             print(mix.encrypt(msg).hex())</span><br><span class="line">&gt;         <span class="keyword">elif</span> op == <span class="string">'2'</span>:</span><br><span class="line">&gt;             msg = bytes.fromhex(input())</span><br><span class="line">&gt;             print(mix.decrypt(msg).hex())</span><br><span class="line">&gt;         <span class="keyword">else</span>:</span><br><span class="line">&gt;             print(<span class="string">'Bye'</span>)</span><br><span class="line">&gt;             <span class="keyword">break</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>这题告诉我一个道理：代码看着费劲就画图</p>
<p>因为加密的时候用了大量的异或运算，所以我下意识去尝试加密chr(0)，在加密512个chr(0)的时候发现后一半不是全为0的，通过推算发现是E(E(IV))其中E表示RSA加密</p>
<p>手绘了一个比较丑的流程图，通过对流程图的分析，可以发现如果解密E(E(IV))+chr(0)*256的话那么第二块的明文就是E(IV)，进而就可以很简单的得到IV</p>
<p><img src="http://i1.bvimg.com/678166/a2af15029f095921.jpg" alt=""></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(host, port)</span>:</span></span><br><span class="line">    s = socket()</span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">h2s</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n2s(int(s, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s2h</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;:02x&#125;'</span>.format(s2n(i)) <span class="keyword">for</span> i <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send1</span><span class="params">(s, mess)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'1'</span></span><br><span class="line">    s.send(<span class="string">'1\n'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> s2h(mess)</span><br><span class="line">    s.send(s2h(mess)+<span class="string">'\n'</span>)</span><br><span class="line">    res = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> res</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send2</span><span class="params">(s, mess)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'2'</span></span><br><span class="line">    s.send(<span class="string">'2\n'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> mess</span><br><span class="line">    s.send(mess+<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">    res = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> res</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    host = <span class="string">'47.95.212.185'</span></span><br><span class="line">    port = <span class="number">38610</span></span><br><span class="line">    s = connect(host, port)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> s.recv(<span class="number">1024</span>)</span><br><span class="line">    res = send1(s, chr(<span class="number">0</span>)*<span class="number">512</span>)</span><br><span class="line">    <span class="string">'''print res'''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> s.recv(<span class="number">1024</span>)</span><br><span class="line">    EE_iv =res[<span class="number">512</span>:]</span><br><span class="line">    res = send2(s, EE_iv+s2h(<span class="number">256</span>*chr(<span class="number">0</span>)))</span><br><span class="line">    p1 = res[:<span class="number">512</span>]</span><br><span class="line">    p2 = res[<span class="number">512</span>:]</span><br><span class="line">    E_iv = p2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> s.recv(<span class="number">1024</span>)</span><br><span class="line">    res = send2(s, E_iv+s2h(chr(<span class="number">0</span>)*<span class="number">256</span>))</span><br><span class="line">    <span class="keyword">print</span> h2s(res[:<span class="number">512</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="Sign-in-SemiHard"><a href="#Sign-in-SemiHard" class="headerlink" title="Sign_in_SemiHard"></a>Sign_in_SemiHard</h3><p>描述：</p>
<blockquote>
<p>47.95.212.185 38611<br>仍然是由CNSS友情赞助 大量的心！<br><strong>hint:</strong>不要想着一步到位 一段一段来 或者 碰碰运气(如果你比较欧的话</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">&gt; <span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">&gt; <span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line">&gt; <span class="keyword">import</span> string</span><br><span class="line">&gt; <span class="keyword">from</span> signal <span class="keyword">import</span> alarm</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">Sign</span>:</span></span><br><span class="line">&gt;  block = T = <span class="number">0</span></span><br><span class="line">&gt;  key = salt = <span class="string">""</span></span><br><span class="line">&gt; </span><br><span class="line">&gt;  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key, salt)</span>:</span></span><br><span class="line">&gt;      self.key = key</span><br><span class="line">&gt;      self.salt = salt</span><br><span class="line">&gt;      self.block = len(key)</span><br><span class="line">&gt; </span><br><span class="line">&gt;  <span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(self, username)</span>:</span></span><br><span class="line">&gt;      <span class="keyword">if</span> <span class="string">b'admin'</span> <span class="keyword">in</span> username:</span><br><span class="line">&gt;          <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">&gt;      sig = md5(self.salt + username).digest()</span><br><span class="line">&gt;      padlen = self.block - len(username) % self.block</span><br><span class="line">&gt;      username += bytes([padlen] * padlen)</span><br><span class="line">&gt;      iv = urandom(self.block)</span><br><span class="line">&gt;      aes = AES.new(self.key, AES.MODE_CBC, iv)</span><br><span class="line">&gt;      c = aes.encrypt(username)</span><br><span class="line">&gt;      <span class="keyword">return</span> iv + c + sig</span><br><span class="line">&gt; </span><br><span class="line">&gt;  <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self, cipher)</span>:</span></span><br><span class="line">&gt;      <span class="keyword">if</span> len(cipher) % self.block != <span class="number">0</span>:</span><br><span class="line">&gt;          <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">&gt;      self.T -= <span class="number">1</span></span><br><span class="line">&gt;      iv = cipher[:self.block]</span><br><span class="line">&gt;      sig = cipher[-self.block:]</span><br><span class="line">&gt;      cipher = cipher[self.block:-self.block]</span><br><span class="line">&gt;      aes = AES.new(self.key, AES.MODE_CBC, iv)</span><br><span class="line">&gt;      p = aes.decrypt(cipher)</span><br><span class="line">&gt;      p = p[:-p[<span class="number">-1</span>]]</span><br><span class="line">&gt;      <span class="keyword">return</span> [p, md5(self.salt + p).digest() == sig]</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">&gt;  unprintable = <span class="string">b""</span></span><br><span class="line">&gt;  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">&gt;      <span class="keyword">if</span> chr(i) <span class="keyword">not</span> <span class="keyword">in</span> string.printable:</span><br><span class="line">&gt;          unprintable += bytes([i])</span><br><span class="line">&gt;  alarm(<span class="number">60</span>)</span><br><span class="line">&gt;  s = Sign(urandom(<span class="number">16</span>), urandom(<span class="number">16</span>))</span><br><span class="line">&gt;  <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">&gt;      print(<span class="string">"Choose:\n[1] Register\n[2] Login"</span>)</span><br><span class="line">&gt;      op = input()</span><br><span class="line">&gt;      <span class="keyword">if</span> op == <span class="string">'1'</span>:</span><br><span class="line">&gt;          user = input(<span class="string">"Input your username(hex): "</span>)</span><br><span class="line">&gt;          token = s.register(bytes.fromhex(user))</span><br><span class="line">&gt;          <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">&gt;              print(<span class="string">"Sorry, invalid username."</span>)</span><br><span class="line">&gt;          <span class="keyword">else</span>:</span><br><span class="line">&gt;              print(<span class="string">"Your token is: %s"</span> % token.hex())</span><br><span class="line">&gt;      <span class="keyword">elif</span> op == <span class="string">'2'</span>:</span><br><span class="line">&gt;          token = input(<span class="string">"Input your token: "</span>)</span><br><span class="line">&gt;          res = s.login(bytes.fromhex(token))</span><br><span class="line">&gt;          <span class="keyword">if</span> <span class="keyword">not</span> res:</span><br><span class="line">&gt;              print(<span class="string">"Sorry, invalid token."</span>)</span><br><span class="line">&gt;          <span class="keyword">elif</span> <span class="keyword">not</span> res[<span class="number">1</span>]:</span><br><span class="line">&gt;              user = res[<span class="number">0</span>].hex()</span><br><span class="line">&gt;              print(<span class="string">"Sorry, your username(hex) %s is inconsistent with given signature."</span> % user)</span><br><span class="line">&gt;          <span class="keyword">else</span>:</span><br><span class="line">&gt;              user = res[<span class="number">0</span>].strip(unprintable).decode(<span class="string">"Latin1"</span>)</span><br><span class="line">&gt;              print(<span class="string">"Login success. Welcome, %s!"</span> % user)</span><br><span class="line">&gt;              <span class="keyword">if</span> user == <span class="string">"admin"</span>:</span><br><span class="line">&gt;                  print(<span class="string">"I have a gift for you: %s"</span> % FLAG)</span><br><span class="line">&gt;      <span class="keyword">else</span>:</span><br><span class="line">&gt;          print(<span class="string">"See you"</span>)</span><br><span class="line">&gt;          <span class="keyword">break</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>考点：</p>
<ul>
<li><p>cbc翻转字节攻击</p>
</li>
<li><p>hash长度拓展攻击</p>
</li>
</ul>
<p>思路：</p>
<ol>
<li>加密chr(20)<em>*5得到md5(salt+chr</em>(20)<em>5)</em></li>
<li><em>hash长度拓展攻击得到chr(20)</em>5…admin的签名sig</li>
<li>加密chr(20)*5…adm1n，得到cipher</li>
<li>利用cbc反转攻击更改密文，使得最后一块明文为admin，然后提交密文，根据回显拿到倒数第二块明文</li>
<li>利用倒数第二块明文更改倒数第三块密文，依次类推，最后更改iv使得最终的明文为chr(20)*5…admin</li>
<li>然后利用sig绕过签名验证，由于admin之前的明文都是不可见字符，所以最终明文就是admin，拿到flag</li>
</ol>
<p>exp如下，写的很丑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashpumpy <span class="keyword">import</span> hashpump</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(host, port)</span>:</span></span><br><span class="line">    s = socket()</span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">h2s</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n2s(int(s, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s2h</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hex(s2n(s))[<span class="number">2</span>:].strip(<span class="string">'L'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(msg)</span>:</span></span><br><span class="line">    pad_length = <span class="number">16</span>-len(msg)%<span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> msg+chr(pad_length)*pad_length</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span><span class="params">(res)</span>:</span></span><br><span class="line">    reg = <span class="string">'Your token is: (.+)\n'</span></span><br><span class="line">    regexp = compile(reg)</span><br><span class="line">    str_1 = regexp.findall(res)</span><br><span class="line">    token = str_1[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_plain</span><span class="params">(res)</span>:</span></span><br><span class="line">    reg = <span class="string">'Sorry, your username\(hex\) (.+) is inconsistent'</span></span><br><span class="line">    regexp = compile(reg)</span><br><span class="line">    str_1 = regexp.findall(res)</span><br><span class="line">    plain = str_1[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> plain</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send1</span><span class="params">(s, mess)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'1'</span></span><br><span class="line">    s.send(<span class="string">'1\n'</span>)</span><br><span class="line">    <span class="keyword">print</span> s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> s2h(mess)</span><br><span class="line">    s.send(s2h(mess)+<span class="string">'\n'</span>)</span><br><span class="line">    res = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> res</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send2</span><span class="params">(s, mess)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'2'</span></span><br><span class="line">    s.send(<span class="string">'2\n'</span>)</span><br><span class="line">    <span class="keyword">print</span> s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> mess</span><br><span class="line">    s.send(mess+<span class="string">'\n'</span>)</span><br><span class="line">    res = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> res</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    host = <span class="string">'47.95.212.185'</span></span><br><span class="line">    port = <span class="number">38611</span></span><br><span class="line">    s = connect(host, port)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> s.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    res = send1(s, chr(<span class="number">20</span>)*<span class="number">5</span>)</span><br><span class="line">    token1 = get_token(res)</span><br><span class="line"></span><br><span class="line">    iv1 = token1[:<span class="number">32</span>]</span><br><span class="line">    cipher1 = token1[<span class="number">32</span>:<span class="number">-32</span>]</span><br><span class="line">    sig1=token1[<span class="number">-32</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    f_sig, mess = hashpump(sig1, chr(<span class="number">20</span>)*<span class="number">5</span>, <span class="string">'admin'</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    mess_list = list(mess)</span><br><span class="line">    mess_list[<span class="number">-2</span>] = <span class="string">'1'</span></span><br><span class="line">    plain = <span class="string">''</span>.join(mess_list)</span><br><span class="line"></span><br><span class="line">    res = send1(s, plain)</span><br><span class="line">    token2 = get_token(res)</span><br><span class="line"></span><br><span class="line">    iv2 = token2[:<span class="number">32</span>]</span><br><span class="line">    cipher2 = token2[<span class="number">32</span>:<span class="number">-32</span>]</span><br><span class="line">    sig2=token2[<span class="number">-32</span>:]</span><br><span class="line"></span><br><span class="line">    cipher2_list = list(h2s(cipher2))</span><br><span class="line">    cipher2_list[<span class="number">51</span><span class="number">-16</span>] = strxor(strxor(cipher2_list[<span class="number">51</span><span class="number">-16</span>], <span class="string">'1'</span>), <span class="string">'i'</span>)</span><br><span class="line">    cipher2 = s2h(<span class="string">''</span>.join(cipher2_list))</span><br><span class="line"></span><br><span class="line">    res = send2(s, iv2+cipher2+f_sig)</span><br><span class="line">    plain = get_plain(res)</span><br><span class="line">    <span class="string">'''print plain'''</span></span><br><span class="line">    <span class="string">'''print plain[32*2:48*2]'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cipher2_list = list(h2s(cipher2))</span><br><span class="line">    cipher2_list[<span class="number">16</span>:<span class="number">32</span>] = strxor(strxor(<span class="string">''</span>.join(cipher2_list[<span class="number">16</span>:<span class="number">32</span>]), h2s(plain[<span class="number">32</span>*<span class="number">2</span>:<span class="number">48</span>*<span class="number">2</span>])), mess[<span class="number">32</span>:<span class="number">48</span>])</span><br><span class="line">    cipher2 = s2h(<span class="string">''</span>.join(cipher2_list))</span><br><span class="line"></span><br><span class="line">    res = send2(s, iv2+cipher2+f_sig)</span><br><span class="line">    plain = get_plain(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cipher2_list = list(h2s(cipher2))</span><br><span class="line">    cipher2_list[<span class="number">0</span>:<span class="number">16</span>] = strxor(strxor(<span class="string">''</span>.join(cipher2_list[<span class="number">0</span>:<span class="number">16</span>]), h2s(plain[<span class="number">16</span>*<span class="number">2</span>:<span class="number">32</span>*<span class="number">2</span>])), mess[<span class="number">16</span>:<span class="number">32</span>])</span><br><span class="line">    cipher2 = s2h(<span class="string">''</span>.join(cipher2_list))</span><br><span class="line"></span><br><span class="line">    res = send2(s, iv2+cipher2+f_sig)</span><br><span class="line">    plain = get_plain(res)</span><br><span class="line"></span><br><span class="line">    <span class="string">'''print iv2'''</span></span><br><span class="line">    f_iv_list = list(h2s(iv2))</span><br><span class="line">    f_iv_list[<span class="number">0</span>:<span class="number">16</span>] = strxor(strxor(<span class="string">''</span>.join(f_iv_list[<span class="number">0</span>:<span class="number">16</span>]), h2s(plain[<span class="number">0</span>*<span class="number">2</span>:<span class="number">16</span>*<span class="number">2</span>])), mess[<span class="number">0</span>:<span class="number">16</span>])</span><br><span class="line">    f_iv = s2h(<span class="string">''</span>.join(f_iv_list))</span><br><span class="line"></span><br><span class="line">    res = send2(s, f_iv+cipher2+f_sig)</span><br><span class="line">    <span class="keyword">print</span> res</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>[1] <a href="https://wenku.baidu.com/view/83d5497a854769eae009581b6bd97f192279bf2c.html" target="_blank" rel="noopener">B 为A 的模m 逆矩阵</a></p>
<p>[2] <a href="https://blog.csdn.net/liuweiran900217/article/details/19933549" target="_blank" rel="noopener">Stanford - Cryptography I</a></p>
<p>[3] <a href="https://wenku.baidu.com/view/b971871ad15abe23492f4db6.html" target="_blank" rel="noopener">初等数论</a></p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#CTF" >
    <span class="tag-code">CTF</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2019/01/04/Essay-Valine配置/">
        <span class="nav-arrow">← </span>
        
          Valine的评论和阅读量统计功能配置
        
      </a>
    
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
    <!-- 二维码 END -->
  </br>
  <span id='/2019/02/03/CTF-hgame-2019/' class="leancloud-visitors" data-flag-title="hgame2019几道有意思的Crypto">
      <em class="post-meta-item-text">这篇水文的阅读量 </em>
      <i class="leancloud-visitors-count">1000000</i>
  </span>
    
        <!-- valine START -->
        <div id="vcomments"></div>
        <!-- valine END -->
    
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#week-1"><span class="toc-nav-text">week 1</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#perfect-secrecy"><span class="toc-nav-text">perfect_secrecy</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#非预期解"><span class="toc-nav-text">非预期解</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#预期解"><span class="toc-nav-text">预期解</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#week-2"><span class="toc-nav-text">week 2</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#HILL"><span class="toc-nav-text">HILL</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#预期解-1"><span class="toc-nav-text">预期解</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#流氓解"><span class="toc-nav-text">流氓解</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#week-3"><span class="toc-nav-text">week 3</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#P4ndd-n"><span class="toc-nav-text">P4ndd!n@!</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#babyRSA"><span class="toc-nav-text">babyRSA</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#basicmath"><span class="toc-nav-text">basicmath</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#week-4"><span class="toc-nav-text">week 4</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#easy-rsa"><span class="toc-nav-text">easy_rsa</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#MixedRSA-Easy"><span class="toc-nav-text">MixedRSA_Easy</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Sign-in-SemiHard"><span class="toc-nav-text">Sign_in_SemiHard</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#参考文章"><span class="toc-nav-text">参考文章</span></a></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://r1ngs.top/2019/02/03/CTF-hgame-2019/';
    var banner = 'undefined'
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "undefined";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "hgame2019几道有意思的Crypto",
        owner: "undefined",
        repo: "undefined",
        oauth: {
          client_id: "undefined",
          client_secret: "undefined"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

<script>
  var disqus_shortname = 'null';
  
  var disqus_url = 'https://r1ngs.top/2019/02/03/CTF-hgame-2019/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'U6Mi8KdqsN4W4eE3mdtxkGOb-gzGzoHsz',
        appKey: 'pEaiuVgetU4E2j06NHtY0dn5',
        notify: false, 
        verify: false, 
        avatar: 'mp', 
        placeholder: '输入你的邮箱，我会在看到后尽快发邮件回复的哦。ヾﾉ≧∀≦)o',
        pageSize: 12,
        visitor: true // 阅读量统计,
    })
</script>
    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2019 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
</body>
</html>